<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><title>Network Layer | Relay Docs</title><meta name="viewport" content="width=device-width"><meta property="og:title" content="Network Layer | Relay Docs"><meta property="og:type" content="website"><meta property="og:url" content="http://facebook.github.io/relay/index.html"><meta property="og:description" content="A JavaScript framework for building data-driven React applications"><link rel="shortcut icon" href="/relay/img/favicon.png"><link rel="stylesheet" href="/relay/css/relay.css"><script type="text/javascript" src="//use.typekit.net/vqa1hcx.js"></script><script type="text/javascript">try{Typekit.load();}catch(e){}</script></head><body><div class="container"><div class="nav-main"><div class="wrap"><a class="nav-home" href="/relay/"><img class="nav-logo" src="/relay/img/logo.svg" width="50" height="50">Relay</a><ul class="nav-site"><li><a href="/relay/prototyping/playground.html" class="">Try it out</a></li><li><a href="/relay/docs/getting-started.html#content" class="active">Docs</a></li><li><a href="/relay/support.html" class="">Support</a></li><li><a href="https://github.com/facebook/relay" class="">GitHub</a></li></ul></div></div><section class="content wrap documentationContent"><div class="nav-docs"><div class="nav-docs-section"><h3>Quick Start</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/getting-started.html#content">Getting Started</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/tutorial.html#content">Tutorial</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/thinking-in-graphql.html#content">Thinking in GraphQL</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/thinking-in-relay.html#content">Thinking In Relay</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/videos.html#content">Videos</a></li></ul></div><div class="nav-docs-section"><h3>Guides</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/guides-containers.html#content">Containers</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-routes.html#content">Routes</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-root-container.html#content">Root Container</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-ready-state.html#content">Ready State</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-mutations.html#content">Mutations</a></li><li><a style="margin-left:0;" class="active" href="/relay/docs/guides-network-layer.html#content">Network Layer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/guides-babel-plugin.html#content">Babel Relay Plugin</a></li></ul></div><div class="nav-docs-section"><h3>GraphQL</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/graphql-relay-specification.html#content">GraphQL Relay Specification</a></li><li><a style="margin-left:20px;" class="" href="/relay/docs/graphql-object-identification.html#content">Object Identification</a></li><li><a style="margin-left:20px;" class="" href="/relay/docs/graphql-connections.html#content">Connection</a></li><li><a style="margin-left:20px;" class="" href="/relay/docs/graphql-mutations.html#content">Mutations</a></li><li><a style="margin-left:20px;" class="" href="/relay/docs/graphql-further-reading.html#content">Further Reading</a></li></ul></div><div class="nav-docs-section"><h3>API Reference</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay.html#content">Relay</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-container.html#content">RelayContainer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-route.html#content">Relay.Route</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-renderer.html#content">Relay.Renderer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-root-container.html#content">Relay.RootContainer</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-ql.html#content">Relay.QL</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-mutation.html#content">Relay.Mutation</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-proptypes.html#content">Relay.PropTypes</a></li><li><a style="margin-left:0;" class="" href="/relay/docs/api-reference-relay-store.html#content">Relay.Store</a></li></ul></div><div class="nav-docs-section"><h3>Interfaces</h3><ul><li><a style="margin-left:0;" class="" href="/relay/docs/interfaces-relay-network-layer.html#content">RelayNetworkLayer</a></li><li><a style="margin-left:20px;" class="" href="/relay/docs/interfaces-relay-mutation-request.html#content">RelayMutationRequest</a></li><li><a style="margin-left:20px;" class="" href="/relay/docs/interfaces-relay-query-request.html#content">RelayQueryRequest</a></li></ul></div></div><div class="inner-content"><a id="content"></a><a class="edit-page-link" href="https://github.com/facebook/relay/blob/master/docs/Guides-NetworkLayer.md" target="_blank">Edit on GitHub</a><h1>Network Layer</h1><div><p>Relay has a network layer abstraction that separates mutations and queries from the actual machinery that sends requests to the GraphQL server. This gives us the flexibility to configure or even completely replace the default network layer via injection.</p><h2><a class="anchor" name="default-network-layer"></a>Default Network Layer <a class="hash-link" href="#default-network-layer">#</a></h2><p>Relay is pre-configured to use a default network layer that works with <a href="https://github.com/graphql/express-graphql" target="_blank">express-graphql</a>. This default network layer is exposed via <code>Relay.DefaultNetworkLayer</code>.</p><p>By default, Relay assumes that GraphQL is served at <code>/graphql</code> relative to the origin where our application is served. This can be re-configured by injecting a custom instantiation of the default network layer.</p><pre class="prism language-javascript">
Relay<span class="token punctuation">.</span><span class="token function">injectNetworkLayer</span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name">Relay<span class="token punctuation">.</span>DefaultNetworkLayer</span><span class="token punctuation">(</span><span class="token string">&#x27;http://example.com/graphql&#x27;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></pre><p>Underneath the hood, the default network layer uses <code>fetch</code> (<a href="https://fetch.spec.whatwg.org" target="_blank">Living Standard</a>). The constructor for <code>Relay.DefaultNetworkLayer</code> takes an optional second argument that accepts any valid initialization property that <code>fetch</code> accepts.</p><pre class="prism language-javascript">
Relay<span class="token punctuation">.</span><span class="token function">injectNetworkLayer</span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name">Relay<span class="token punctuation">.</span>DefaultNetworkLayer</span><span class="token punctuation">(</span><span class="token string">&#x27;http://example.com/graphql&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    credentials<span class="token punctuation">:</span> <span class="token string">&#x27;same-origin&#x27;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><div class="line-highlight" style="height:20px;top:40px;"></div></pre><p>When it sends queries, it will automatically fail requests after a 15 second timeout. Also, failed requests are automatically retried twice, with a 1 second delay and a 3 second delay, respectively.</p><p>Like the GraphQL URI, the timeout and retry behavior can be configured:</p><pre class="prism language-javascript">
Relay<span class="token punctuation">.</span><span class="token function">injectNetworkLayer</span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name">Relay<span class="token punctuation">.</span>DefaultNetworkLayer</span><span class="token punctuation">(</span><span class="token string">&#x27;http://example.com/graphql&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    fetchTimeout<span class="token punctuation">:</span> <span class="token number">30000</span><span class="token punctuation">,</span>   <span spellcheck="true" class="token comment">// Timeout after 30s.</span>
    retryDelays<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">5000</span><span class="token punctuation">]</span><span class="token punctuation">,</span>   <span spellcheck="true" class="token comment">// Only retry once after a 5s delay.</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><div class="line-highlight" style="height:20px;top:40px;"></div><div class="line-highlight" style="height:20px;top:60px;"></div></pre><p>Unlike queries, failed requests for mutations are not automatically retried.</p><p>Custom HTTP headers can be configured by providing a <code>headers</code> object:</p><pre class="prism language-javascript">
Relay<span class="token punctuation">.</span><span class="token function">injectNetworkLayer</span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name">Relay<span class="token punctuation">.</span>DefaultNetworkLayer</span><span class="token punctuation">(</span><span class="token string">&#x27;http://example.com/graphql&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    headers<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      Authorization<span class="token punctuation">:</span> <span class="token string">&#x27;Basic SSdsbCBmaW5kIHNvbWV0aGluZyB0byBwdXQgaGVyZQ==&#x27;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span><div class="line-highlight" style="height:20px;top:40px;"></div><div class="line-highlight" style="height:20px;top:60px;"></div><div class="line-highlight" style="height:20px;top:80px;"></div></pre><h2><a class="anchor" name="custom-network-layers"></a>Custom Network Layers <a class="hash-link" href="#custom-network-layers">#</a></h2><p>Relay also lets us completely replace the default network layer.</p><p>Custom network layers must conform to the following <a href="interfaces-relay-network-layer.html" target="_blank">RelayNetworkLayer</a> interface. Although the default network layer is an instantiable class that accepts some configuration, this is not a requirement of an injected network layer.</p><p>For example, a network layer can be a simple object that conforms to the interface:</p><pre class="prism language-javascript">
<span class="token keyword">var</span> myNetworkLayer <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">sendMutation</span><span class="token punctuation">(</span>mutationRequest<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span spellcheck="true" class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">sendQueries</span><span class="token punctuation">(</span>queryRequests<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span spellcheck="true" class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">supports</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span spellcheck="true" class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Relay<span class="token punctuation">.</span><span class="token function">injectNetworkLayer</span><span class="token punctuation">(</span>myNetworkLayer<span class="token punctuation">)</span><span class="token punctuation">;</span></pre><p>You can read more about the API <a href="interfaces-relay-network-layer.html" target="_blank">RelayNetworkLayer</a> interface.</p></div><div class="docs-prevnext"><a class="docs-next" href="guides-babel-plugin.html#content">Next →</a></div></div></section><footer class="wrap"><div class="right">©2016 Facebook Inc.</div></footer></div><div id="fb-root"></div><script>
            !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
              ga('create', 'UA-71174216-1', 'auto');
              ga('send', 'pageview');
          </script></body></html>